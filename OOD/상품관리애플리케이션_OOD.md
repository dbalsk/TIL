# **상품 관리 애플리케이션**
> [데이터베이스로 관리되는 상품관리애플리케이션](https://github.com/dbalsk/TIL/blob/main/DataBase/%EC%83%81%ED%92%88%EA%B4%80%EB%A6%AC%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98_DB.md)에 객체지향적 설계를 더하여 프로젝트를 완성해보자. 또한 테스트 코드를 작성하여 리팩토링을 진행해보자. 
  
## 추상화
>클래스를 추상화함으로써 유연성을 높이는 설계로 개선해보자. 

**✔ 애플리케이션 실행환경**   
기존의 상품관리애플리케이션은 실행환경에 따라 SimpleProductService(서비스 클래스)에 서로 다른 빈이 주입되어야 하는 상황

- 테스트 환경 (로컬 개발환경) -> **ListProductRepository** 빈 주입 (리스트 기반 리포지토리 클래스)
- 서비스 환경 -> **DatabaseProductRepository** 빈 주입 (데이터베이스 기반 리포지토리 클래스)

**✔ 인터페이스에 의존 (추상화)**   
인터페이스에 의존하도록 구현함으로써 실행환경에 따라 동작을 정의하도록 구현 

- 인터페이스 생성: 두 리포지토리 클래스의 인터페이스로 **ProductRepository** 생성 

- 인터페이스 위치: **도메인 계층**  
-> 두 리포지토리 클래스가 위치하는 **인프라스트럭처 계층**에 위치할 경우 **도메인 주도 설계의 의존성 방향에 위배**됨. (다른 모든 계층은 인프라스트럭처 계층에 의존하면 안됨)

- 의존성 방향: **인터페이스(추상적 존재)로 의존성 방향**이 모임. 
    - **서비스 클래스**: 인터페이스를 사용하기에 인터페이스에 의존
    - **리포지토리 클래스**: 인터페이스를 구현하기에 인터페이스에 의존  

- 인터페이스의 효과: 구체적인 존재가 아닌 **추상적인 존재에 의존**함으로써 애플리케이션의 **동작을 코드 변경 없이 실행 시점**에 결정 

**✔ 문제 해결**
- 문제1: 인터페이스에 두 클래스의 빈 중, 어떤 것을 넣을지 판단 불가 
    - 해결방법: **Spring Profiles** 사용 (테스트/서비스 환경에 따라 다르게 적용할 수 있도록)
        - 각 구현체에 **@Profile 추가**    
        ```@Profile("test"), @Profile("prod")```   
        - **application.properties** 파일에서 어떤 Profile로 실행할지 지정    
        ```spring.profiles.active=test```  
        - 명령어로 Profile 명시할 경우 그에 따라 실행 (명령어로 지정하지 않는 경우 위 파일에 따라 실행)  

- 문제2: 테스트 환경에서 실행 불가   
  (jdbc 의존성에서 **데이터베이스 연결 관련 자동설정**을 진행하기에 데이터베이스를 사용하지 않는 경우 실행 불가)
    - 해결방법: **properties 파일 나누기**
      >[-**Profile**]에 따라 스프링 부트에서 사용될 설정파일을 자동으로 매핑해줌.
        - **application.properties** -> 기본 Profile로 test를 지정    
            (기본값은 test로 설정하는 것이 좋음. 프로젝트 다운로드할 경우 데이터베이스없이 바로 실행 가능하도록)
        - **application-test.properties** -> 데이터베이스 연결 자동설정 제외   
        - **application-prod.properties** -> 데이터베이스 연결정보
        - ApplicationRunner에 @Profile("prod") 추가
     
          
          
